<!DOCTYPE html><html lang="en"> <head><meta charset="utf-8"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="viewport" content="width=device-width"><meta name="generator" content="Astro v5.16.6"><title>Sorting in a List Control</title></head> <body> <h1>Sorting in a List Control</h1>  <p><em>Usage SortItems()</em></p> <p>2025-12-14</p> <p>Written by: xiaobin</p> <p>Unless a list view has the style LVS_NOSORTHEADER,
clicking a header item sends an LVN_COLUMNCLICK notification to the list view’s parent.
An application’s usual response to an LVN_COLUMNCLICK notification is to call CListCtrl::SortItems to sort the list view items.</p>
<p>You do have to provide a callback function that the control’s built-in sorting routine can
call to compare a pair of arbitrarily selected items.
The bad news is that the comparison function receives just three parameters:
the 32-bit lParam values of the two items being compared
and an application-defined lParam value that equals the second parameter passed to SortItems.</p>
<p>And an application that stores its own item data uses memory inefficiently if it assigns text strings to the list view’s items and
subitems because then the data ends up being stored in memory twice.
You can avoid such wastefulness by specifying LPSTR_TEXTCALLBACK for the item and subitem text and
providing text to the list view control in response to LVN_GETDISPINFO notifications.</p>
<h4 id="lvn-event">LVN event</h4>
<ul>
<li>LVN_COLUMNCLICK</li>
</ul>
<p><img src="https://github.com/tdtc-hrb/csdn/raw/master/images/col_click-event_handler.png" alt="col click - list control"></p>
<ul>
<li>LVN_GETDISPINFO</li>
</ul>
<p><img src="https://github.com/tdtc-hrb/csdn/raw/master/images/disp_info-event_handler.png" alt="disp info - list control"></p>
<h3 id="sortitems">SortItems</h3>
<p>package info:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>typedef struct tagITEMINFO {</span></span>
<span class="line"><span>	CString     strServer;</span></span>
<span class="line"><span>	CString     strDatabase;</span></span>
<span class="line"><span>	CString     strUser;</span></span>
<span class="line"><span>	CString     strPassword;</span></span>
<span class="line"><span>	int         nType;</span></span>
<span class="line"><span>} ITEMINFO;</span></span></code></pre>
<h4 id="lvn_columnclick---event">LVN_COLUMNCLICK - event</h4>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>void CMFCApplication1Dlg::OnLvnColumnclickList2(NMHDR *pNMHDR, LRESULT *pResult)</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>	LPNMLISTVIEW pNMLV = reinterpret_cast&#x3C;LPNMLISTVIEW>(pNMHDR);</span></span>
<span class="line"><span>	// TODO: Add your control notification handler code here</span></span>
<span class="line"><span>	m_ListOfDb.SortItems(CompareFunc, pNMLV->iSubItem);</span></span>
<span class="line"><span>	*pResult = 0;</span></span>
<span class="line"><span>}</span></span></code></pre>
<ul>
<li>CompareFunc</li>
</ul>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>int CALLBACK CMFCApplication1Dlg::CompareFunc(LPARAM lParam1, LPARAM lParam2, LPARAM lParamSort)</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>	ITEMINFO* pItem1 = (ITEMINFO*)lParam1;</span></span>
<span class="line"><span>	ITEMINFO* pItem2 = (ITEMINFO*)lParam2;</span></span>
<span class="line"><span>	int nResult;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>	switch (lParamSort) {</span></span>
<span class="line"><span>	case 0: // Server</span></span>
<span class="line"><span>		nResult = pItem1->strServer.CompareNoCase(pItem2->strServer);</span></span>
<span class="line"><span>		break;</span></span>
<span class="line"><span>	case 1: // data base</span></span>
<span class="line"><span>		nResult = pItem1->strDatabase.CompareNoCase(pItem2->strDatabase);</span></span>
<span class="line"><span>		break;</span></span>
<span class="line"><span>	case 2: // user</span></span>
<span class="line"><span>		nResult = pItem1->strUser.CompareNoCase(pItem2->strUser);</span></span>
<span class="line"><span>		break;</span></span>
<span class="line"><span>	case 3: // password</span></span>
<span class="line"><span>		nResult = pItem1->strPassword.CompareNoCase(pItem2->strPassword);</span></span>
<span class="line"><span>		break;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>	case 4: // type</span></span>
<span class="line"><span>		nResult = pItem1->nType - pItem2->nType;</span></span>
<span class="line"><span>		break;</span></span>
<span class="line"><span>	}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>	return nResult;</span></span>
<span class="line"><span>}</span></span></code></pre>
<h4 id="getdispinfo---envent">Getdispinfo - envent</h4>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>void CMFCApplication1Dlg::OnLvnGetdispinfoList2(NMHDR *pNMHDR, LRESULT *pResult)</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>	NMLVDISPINFO *pDispInfo = reinterpret_cast&#x3C;NMLVDISPINFO*>(pNMHDR);</span></span>
<span class="line"><span>	// TODO: Add your control notification handler code here</span></span>
<span class="line"><span>	CString string;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>	if (pDispInfo->item.mask &#x26; LVIF_TEXT) {</span></span>
<span class="line"><span>		ITEMINFO* pItem = (ITEMINFO*)pDispInfo->item.lParam;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>		switch (pDispInfo->item.iSubItem) {</span></span>
<span class="line"><span></span></span>
<span class="line"><span>		case 0: // Server</span></span>
<span class="line"><span>			::lstrcpy(pDispInfo->item.pszText, pItem->strServer);</span></span>
<span class="line"><span>			break;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>		case 1: // Database</span></span>
<span class="line"><span>			::lstrcpy(pDispInfo->item.pszText, pItem->strDatabase);</span></span>
<span class="line"><span>			break;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>		case 2: // User</span></span>
<span class="line"><span>			::lstrcpy(pDispInfo->item.pszText, pItem->strUser);</span></span>
<span class="line"><span>			break;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>		case 3: // Password</span></span>
<span class="line"><span>			::lstrcpy(pDispInfo->item.pszText, pItem->strPassword);</span></span>
<span class="line"><span>			break;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>		case 4: // Type</span></span>
<span class="line"><span>			string.Format(_T("%u"), pItem->nType);</span></span>
<span class="line"><span>			::lstrcpy(pDispInfo->item.pszText, string);</span></span>
<span class="line"><span>			break;</span></span>
<span class="line"><span>		}</span></span>
<span class="line"><span>	}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>	*pResult = 0;</span></span>
<span class="line"><span>}</span></span></code></pre>
<h3 id="additem">AddItem</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>BOOL CMFCApplication1Dlg::AddItem(int nIndex)</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>	//</span></span>
<span class="line"><span>	// Allocate a new ITEMINFO structure and initialize it with information</span></span>
<span class="line"><span>	// about the item.</span></span>
<span class="line"><span>	//</span></span>
<span class="line"><span>	ITEMINFO* pItem;</span></span>
<span class="line"><span>	try {</span></span>
<span class="line"><span>		pItem = new ITEMINFO;</span></span>
<span class="line"><span>	}</span></span>
<span class="line"><span>	catch (CMemoryException* e) {</span></span>
<span class="line"><span>		e->Delete();</span></span>
<span class="line"><span>		return FALSE;</span></span>
<span class="line"><span>	}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>	CConnectString *conn = reinterpret_cast&#x3C;CConnectString *>(this->ListOfConnStrings[nIndex]);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>	pItem->strServer = conn->GetServer();</span></span>
<span class="line"><span>	pItem->strDatabase = conn->GetDb();</span></span>
<span class="line"><span>	pItem->strUser = conn->GetUser();</span></span>
<span class="line"><span>	pItem->strPassword = conn->GetPwd();</span></span>
<span class="line"><span>	pItem->nType = conn->GetType();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>	//</span></span>
<span class="line"><span>	// Add the item to the list view.</span></span>
<span class="line"><span>	//</span></span>
<span class="line"><span>	LV_ITEM lvi;</span></span>
<span class="line"><span>	lvi.mask = LVIF_TEXT | LVIF_PARAM;</span></span>
<span class="line"><span>	lvi.iItem = nIndex;</span></span>
<span class="line"><span>	lvi.iSubItem = 0;</span></span>
<span class="line"><span>	lvi.iImage = 0;</span></span>
<span class="line"><span>	lvi.pszText = LPSTR_TEXTCALLBACK;</span></span>
<span class="line"><span>	lvi.lParam = (LPARAM)pItem;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>	if (m_ListOfDb.InsertItem(&#x26;lvi) == -1)</span></span>
<span class="line"><span>		return FALSE;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>	return TRUE;</span></span>
<span class="line"><span>}</span></span></code></pre>
<h2 id="ref">Ref</h2>
<ul>
<li>10.4.3. Sorting in a List View(P649)- Programming Windows With MFC</li>
<li><a href="https://github.com/definedrisk/prosise-mfc2e">CD-ROM Jeff Prosise MFC 2nd Edition.zip</a></li>
<li><a href="https://mega.nz/file/uYd0GRjY#6nv3hnMd2PdQg4PDaLGI_xR7DHqxow4u2BsbGKJFCoY">ObjArraySerialDemo2.zip</a></li>
</ul>  <footer> <a href="https://tdtc-hrb.github.io/blog-frontend">blog-frontend</a> <a href="https://tdtc-hrb.github.io/com-vc">com-vc</a> <a href="https://tdtc-hrb.github.io/css-tws">css-tws</a> <a href="https://tdtc-hrb.github.io/ops-win">ops-win</a> </footer> </body></html>